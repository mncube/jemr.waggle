---
title: "analysis_growth"
output: html_document
date: "2025-07-07"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Import Functions, Data, and Libraries

```{r}
devtools::load_all()
rawdat <- cleanraw(mo_map_raw) 
alldat <- rawdat |> pwide(handle_dups = "high")
bdat <- alldat$base
odat <- alldat$out
newdat <- alldat$dat
dat2 <- build_analysis_sets(out_data = newdat, orig_matched_data = matdat_loc3)$cc
dat2 <- dat2 |> identify_bottom_percentiles(percentiles = c(0.2, 0.3),
                                   id_var= "STUDENT_BUSINESS_IDENTIFIER",
                                   score_var  = "ASSESS_SCORE",
                                   group_var  = "GRADE")
```

# Analysis

```{r}
 res <- model_workflow(dat2,
                   modname = c("All", "Male", "Female"),
                   group = c("All",
                             'GENDER_MALE == 1',
                             'GENDER_FEMALE == 1'),
                   .control = c("GENDER_MALE + GRADE + NCES_PUBLIC_PCTFRLUNCH_ROUNDED + URBAN_LOC_21",
                                "GRADE + NCES_PUBLIC_PCTFRLUNCH_ROUNDED + URBAN_LOC_21",
                                "GRADE + NCES_PUBLIC_PCTFRLUNCH_ROUNDED + URBAN_LOC_21"),
                   .analysis = "growth")

```


```{r}
 mods <- run_model(dat2,
                   modname = c("All", "Male", "Female"),
                   group = c("All",
                             'GENDER_MALE == 1',
                             'GENDER_FEMALE == 1'),
                   .control = c("GENDER_MALE + GRADE + NCES_PUBLIC_PCTFRLUNCH_ROUNDED + URBAN_LOC_21",
                                "GRADE + NCES_PUBLIC_PCTFRLUNCH_ROUNDED + URBAN_LOC_21",
                                "GRADE + NCES_PUBLIC_PCTFRLUNCH_ROUNDED + URBAN_LOC_21"),
                   .analysis = "growth")
```


```{r}
dat_growth <- get_analytic_sample(dat = dat2, .analysis = "growth",
                                  .group = 'GRADE == "1"')
dat_badj <- get_analytic_sample(dat = dat2, .analysis = "badj", .group = 'GRADE == "1"')
```

